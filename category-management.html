<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Quản lý loại sản phẩm</title>
  <style>
    body {
      font-family: 'Segoe UI', Arial, sans-serif;
      background: #0f1724;
      color: #e2e8f0;
      margin: 0;
      padding: 24px;
    }
    .container {
      max-width: 1000px;
      margin: 0 auto;
    }
    h1 {
      color: #38bdf8;
      font-size: 22px;
    }
    .card {
      background: rgba(255,255,255,0.04);
      border-radius: 12px;
      padding: 20px;
      margin-top: 20px;
      box-shadow: 0 0 10px rgba(0,0,0,0.3);
    }
    input, textarea, select {
      background: rgba(255,255,255,0.05);
      color: #e2e8f0;
      border: 1px solid rgba(255,255,255,0.1);
      border-radius: 8px;
      padding: 8px;
      width: 100%;
      outline: none;
    }
    button {
      padding: 8px 14px;
      border: none;
      border-radius: 6px;
      cursor: pointer;
      font-weight: 600;
    }
    button.add {
      background: #06b6d4;
      color: #041324;
    }
    button.edit { background: #1e3a8a; color: #e0f2fe; }
    button.delete { background: #dc2626; color: white; }
    button.toggle { background: #475569; color: white; }
    button.reset { background: transparent; border: 1px solid #475569; color: #94a3b8; }
    table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 16px;
    }
    th, td {
      text-align: left;
      padding: 10px;
      border-bottom: 1px solid rgba(255,255,255,0.08);
    }
    th { color: #94a3b8; font-size: 14px; }
    td small { color: #94a3b8; }
    .hidden { opacity: 0.5; text-decoration: line-through; }
    .actions button {
      margin-right: 6px;
      font-size: 13px;
    }
    .status {
      display: inline-block;
      padding: 4px 8px;
      border-radius: 999px;
      background: rgba(255,255,255,0.08);
      font-size: 12px;
    }
  </style>
</head>
<body>
  <div class="container">
    <h1>Quản lý loại sản phẩm</h1>
    <div class="card">
      <h3>Thêm / Sửa loại sản phẩm</h3>
      <div>
        <label for="catName">Tên loại sản phẩm</label>
        <input type="text" id="catName" placeholder="Ví dụ: LQ, FF, GiftCard..." />
      </div>
      <div style="margin-top:10px">
        <label for="catDesc">Mô tả</label>
        <textarea id="catDesc" rows="3" placeholder="Mô tả ngắn gọn về loại sản phẩm"></textarea>
      </div>
      <div style="margin-top:10px;display:flex;gap:8px">
        <button id="btnSave" class="add">Lưu</button>
        <button id="btnReset" class="reset">Xóa form</button>
      </div>
      <small id="formMsg" style="display:block;margin-top:8px;color:#94a3b8">Dữ liệu được lưu tạm trong LocalStorage (chỉ demo).</small>
    </div>

    <div class="card">
      <h3>Danh sách loại sản phẩm</h3>
      <div id="catTableWrap"></div>
    </div>
  </div>

  <script>
    const LS_KEY = 'PRODUCT_CATEGORIES';

    function getCats() {
      try { return JSON.parse(localStorage.getItem(LS_KEY)) || []; }
      catch { return []; }
    }
    function setCats(data) { localStorage.setItem(LS_KEY, JSON.stringify(data)); }
    function genId() { return 'c' + Math.random().toString(36).substr(2, 8); }

    function renderTable() {
      const cats = getCats();
      const wrap = document.getElementById('catTableWrap');
      if (cats.length === 0) {
        wrap.innerHTML = '<p style="color:#94a3b8">Chưa có loại sản phẩm nào. Hãy thêm mới ở trên.</p>';
        return;
      }

      let html = '<table><thead><tr><th>Tên loại</th><th>Mô tả</th><th>Trạng thái</th><th>Thao tác</th></tr></thead><tbody>';
      cats.forEach(cat => {
        html += `<tr class="${cat.hidden ? 'hidden' : ''}">
          <td><strong>${escapeHtml(cat.name)}</strong></td>
          <td>${escapeHtml(cat.desc || '')}</td>
          <td><span class="status">${cat.hidden ? 'Đã ẩn' : 'Hiển thị'}</span></td>
          <td class="actions">
            <button class="edit" onclick="editCat('${cat.id}')">Sửa</button>
            <button class="delete" onclick="deleteCat('${cat.id}')">Xóa</button>
            <button class="toggle" onclick="toggleCat('${cat.id}')">${cat.hidden ? 'Hiện' : 'Ẩn'}</button>
          </td>
        </tr>`;
      });
      html += '</tbody></table>';
      wrap.innerHTML = html;
    }

    function escapeHtml(s) {
      return s.replaceAll('&','&amp;').replaceAll('<','&lt;').replaceAll('>','&gt;');
    }

    document.getElementById('btnSave').addEventListener('click', () => {
      const name = document.getElementById('catName').value.trim();
      const desc = document.getElementById('catDesc').value.trim();
      if (!name) return alert('Tên loại sản phẩm không được để trống!');

      let cats = getCats();
      const editId = document.getElementById('btnSave').dataset.editId;

      if (editId) {
        const c = cats.find(x => x.id === editId);
        if (!c) return alert('Không tìm thấy loại sản phẩm!');
        c.name = name;
        c.desc = desc;
        setCats(cats);
        document.getElementById('formMsg').innerText = 'Đã cập nhật loại sản phẩm.';
        delete document.getElementById('btnSave').dataset.editId;
      } else {
        const newCat = {
          id: genId(),
          name,
          desc,
          hidden: false,
          createdAt: new Date().toISOString()
        };
        cats.unshift(newCat);
        setCats(cats);
        document.getElementById('formMsg').innerText = 'Đã thêm loại sản phẩm mới.';
      }

      resetForm();
      renderTable();
    });

    function editCat(id) {
      const cats = getCats();
      const c = cats.find(x => x.id === id);
      if (!c) return;
      document.getElementById('catName').value = c.name;
      document.getElementById('catDesc').value = c.desc;
      document.getElementById('btnSave').dataset.editId = id;
      document.getElementById('formMsg').innerText = 'Đang sửa loại sản phẩm: ' + c.name;
      window.scrollTo({ top: 0, behavior: 'smooth' });
    }

    function deleteCat(id) {
      if (!confirm('Bạn có chắc muốn xóa loại sản phẩm này?')) return;
      let cats = getCats();
      cats = cats.filter(x => x.id !== id);
      setCats(cats);
      renderTable();
    }

    function toggleCat(id) {
      let cats = getCats();
      const c = cats.find(x => x.id === id);
      if (!c) return;
      c.hidden = !c.hidden;
      setCats(cats);
      renderTable();
    }

    document.getElementById('btnReset').addEventListener('click', resetForm);
    function resetForm() {
      document.getElementById('catName').value = '';
      document.getElementById('catDesc').value = '';
      document.getElementById('formMsg').innerText = 'Dữ liệu được lưu tạm trong LocalStorage (chỉ demo).';
      delete document.getElementById('btnSave').dataset.editId;
    }

    renderTable();
  </script>
</body>
</html>
