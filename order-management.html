<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Quản lý đơn hàng</title>
  <style>
    body {
      font-family: 'Poppins', sans-serif;
      background-color: #0f1724;
      color: #e2e8f0;
      margin: 0;
      padding: 24px;
    }
    .container { max-width: 1100px; margin: auto; }
    h1 { color: #38bdf8; font-size: 22px; }

    .card {
      background: rgba(255,255,255,0.05);
      border-radius: 12px;
      padding: 20px;
      margin-top: 20px;
      box-shadow: 0 0 10px rgba(0,0,0,0.3);
    }

    input, select {
      background: rgba(255,255,255,0.06);
      border: 1px solid rgba(255,255,255,0.1);
      color: #e2e8f0;
      padding: 8px;
      border-radius: 8px;
      outline: none;
    }

    button {
      padding: 8px 14px;
      border: none;
      border-radius: 6px;
      cursor: pointer;
      font-weight: 600;
    }
    button.search { background: #06b6d4; color: #041324; }
    button.edit { background: #1e3a8a; color: #e0f2fe; }
    button.delete { background: #dc2626; color: white; }

    table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 16px;
    }
    th, td {
      text-align: left;
      padding: 10px;
      border-bottom: 1px solid rgba(255,255,255,0.08);
    }
    th { color: #94a3b8; font-size: 14px; }

    .status {
      font-weight: bold;
      border-radius: 6px;
      padding: 4px 8px;
    }
    .new { color: #0ea5e9; }
    .processing { color: #fbbf24; }
    .delivered { color: #22c55e; }
    .cancelled { color: #ef4444; }

    .filter-group {
      display: flex;
      gap: 10px;
      flex-wrap: wrap;
      margin-bottom: 10px;
    }

    .modal {
      position: fixed;
      top: 0; left: 0;
      width: 100%; height: 100%;
      background: rgba(0,0,0,0.6);
      display: none;
      justify-content: center;
      align-items: center;
    }
    .modal-content {
      background: #1e293b;
      padding: 20px;
      border-radius: 12px;
      width: 90%;
      max-width: 500px;
      color: #e2e8f0;
    }
    .modal h3 { color: #38bdf8; }
    .close-btn {
      background: transparent;
      border: 1px solid #475569;
      color: #94a3b8;
      float: right;
    }
  </style>
</head>
<body>
  <div class="container">
    <h1>Quản lý đơn đặt hàng</h1>

    <!-- Bộ lọc -->
    <div class="card">
      <h3>Tìm kiếm và lọc đơn hàng</h3>
      <div class="filter-group">
        <div>
          <label>Từ ngày:</label>
          <input type="date" id="fromDate">
        </div>
        <div>
          <label>Đến ngày:</label>
          <input type="date" id="toDate">
        </div>
        <div>
          <label>Tình trạng:</label>
          <select id="statusFilter">
            <option value="">-- Tất cả --</option>
            <option value="Mới đặt">Mới đặt</option>
            <option value="Đã xử lý">Đã xử lý</option>
            <option value="Đã giao">Đã giao</option>
            <option value="Hủy">Hủy</option>
          </select>
        </div>
        <div style="align-self: end;">
          <button class="search" onclick="filterOrders()">Lọc đơn hàng</button>
        </div>
      </div>
    </div>

    <!-- Bảng đơn hàng -->
    <div class="card">
      <h3>Danh sách đơn hàng</h3>
      <div id="orderTableWrap"></div>
    </div>
  </div>

  <!-- Modal chi tiết đơn hàng -->
  <div class="modal" id="orderModal">
    <div class="modal-content">
      <button class="close-btn" onclick="closeModal()">Đóng</button>
      <h3>Chi tiết đơn hàng</h3>
      <div id="orderDetail"></div>
    </div>
  </div>

  <script>
    const LS_KEY = 'ORDER_LIST';

    function getOrders() {
      try { return JSON.parse(localStorage.getItem(LS_KEY)) || []; }
      catch { return []; }
    }
    function setOrders(data) { localStorage.setItem(LS_KEY, JSON.stringify(data)); }

    // Demo dữ liệu mẫu
    if (getOrders().length === 0) {
      setOrders([
        {id:'OD001', customer:'Nguyễn Văn A', date:'2025-10-01', total:1200000, status:'Mới đặt', products:[{name:'LQ Account', qty:1, price:1200000}]},
        {id:'OD002', customer:'Trần Thị B', date:'2025-10-03', total:500000, status:'Đã xử lý', products:[{name:'FF Gift Card', qty:1, price:500000}]},
        {id:'OD003', customer:'Lê Minh C', date:'2025-10-05', total:850000, status:'Đã giao', products:[{name:'PUBG Account', qty:1, price:850000}]},
        {id:'OD004', customer:'Phạm D', date:'2025-10-06', total:700000, status:'Hủy', products:[{name:'Liên Minh Huyền Thoại', qty:1, price:700000}]}
      ]);
    }

    function renderOrders(list = getOrders()) {
      const wrap = document.getElementById('orderTableWrap');
      if (list.length === 0) {
        wrap.innerHTML = '<p style="color:#94a3b8">Không có đơn hàng nào phù hợp.</p>';
        return;
      }

      let html = '<table><thead><tr><th>Mã</th><th>Khách hàng</th><th>Ngày đặt</th><th>Tổng tiền</th><th>Tình trạng</th><th>Thao tác</th></tr></thead><tbody>';
      list.forEach(o => {
        let cls = '';
        if (o.status === 'Mới đặt') cls = 'new';
        else if (o.status === 'Đã xử lý') cls = 'processing';
        else if (o.status === 'Đã giao') cls = 'delivered';
        else cls = 'cancelled';

        html += `<tr>
          <td>${o.id}</td>
          <td>${o.customer}</td>
          <td>${o.date}</td>
          <td>${o.total.toLocaleString()} ₫</td>
          <td><span class="status ${cls}">${o.status}</span></td>
          <td>
            <button class="edit" onclick="viewDetail('${o.id}')">Xem</button>
            <button class="delete" onclick="updateStatus('${o.id}')">Cập nhật</button>
          </td>
        </tr>`;
      });
      html += '</tbody></table>';
      wrap.innerHTML = html;
    }

    function filterOrders() {
      const from = document.getElementById('fromDate').value;
      const to = document.getElementById('toDate').value;
      const status = document.getElementById('statusFilter').value;
      let orders = getOrders();

      if (from) orders = orders.filter(o => o.date >= from);
      if (to) orders = orders.filter(o => o.date <= to);
      if (status) orders = orders.filter(o => o.status === status);

      renderOrders(orders);
    }

    function viewDetail(id) {
      const order = getOrders().find(o => o.id === id);
      if (!order) return;

      const details = `
        <p><strong>Mã đơn:</strong> ${order.id}</p>
        <p><strong>Khách hàng:</strong> ${order.customer}</p>
        <p><strong>Ngày đặt:</strong> ${order.date}</p>
        <p><strong>Tình trạng:</strong> ${order.status}</p>
        <p><strong>Tổng tiền:</strong> ${order.total.toLocaleString()} ₫</p>
        <hr>
        <p><strong>Sản phẩm:</strong></p>
        <ul>${order.products.map(p => `<li>${p.name} - SL: ${p.qty} - ${p.price.toLocaleString()} ₫</li>`).join('')}</ul>
      `;
      document.getElementById('orderDetail').innerHTML = details;
      document.getElementById('orderModal').style.display = 'flex';
    }

    function closeModal() {
      document.getElementById('orderModal').style.display = 'none';
    }

    function updateStatus(id) {
      const orders = getOrders();
      const order = orders.find(o => o.id === id);
      if (!order) return;

      const newStatus = prompt('Cập nhật tình trạng (Mới đặt, Đã xử lý, Đã giao, Hủy):', order.status);
      if (!newStatus) return;
      if (!['Mới đặt','Đã xử lý','Đã giao','Hủy'].includes(newStatus)) {
        alert('Trạng thái không hợp lệ.');
        return;
      }
      order.status = newStatus;
      setOrders(orders);
      renderOrders();
    }

    renderOrders();
  </script>
</body>
</html>
