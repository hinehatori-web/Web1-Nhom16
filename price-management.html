<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Quản lý giá bán</title>
  <style>
    body {
      font-family: 'Poppins', sans-serif;
      background-color: #0f1724;
      color: #e2e8f0;
      margin: 0;
      padding: 24px;
    }
    .container { max-width: 1000px; margin: auto; }
    h1 { color: #38bdf8; font-size: 22px; }
    .card {
      background: rgba(255,255,255,0.04);
      border-radius: 12px;
      padding: 20px;
      margin-top: 20px;
      box-shadow: 0 0 10px rgba(0,0,0,0.3);
    }
    label { display: block; margin-top: 10px; }
    input, select {
      width: 100%;
      background: rgba(255,255,255,0.06);
      border: 1px solid rgba(255,255,255,0.1);
      color: #e2e8f0;
      padding: 8px;
      border-radius: 8px;
      outline: none;
      margin-top: 4px;
    }
    button {
      padding: 8px 14px;
      border: none;
      border-radius: 6px;
      cursor: pointer;
      font-weight: 600;
    }
    button.add { background: #06b6d4; color: #041324; }
    button.edit { background: #1e3a8a; color: #e0f2fe; }
    button.delete { background: #dc2626; color: white; }
    button.reset { background: transparent; border: 1px solid #475569; color: #94a3b8; }
    table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 16px;
    }
    th, td {
      text-align: left;
      padding: 10px;
      border-bottom: 1px solid rgba(255,255,255,0.08);
    }
    th { color: #94a3b8; font-size: 14px; }
    .actions button { margin-right: 6px; font-size: 13px; }
    .search {
      margin-bottom: 10px;
    }
    .highlight {
      color: #22c55e;
      font-weight: bold;
    }
  </style>
</head>
<body>
  <div class="container">
    <h1>Quản lý giá bán sản phẩm</h1>

    <!-- Form nhập / sửa thông tin giá -->
    <div class="card">
      <h3>Thêm / Sửa giá sản phẩm</h3>

      <label>Loại sản phẩm</label>
      <select id="productType">
        <option value="">-- Chọn loại sản phẩm --</option>
        <option>LQ</option>
        <option>FF</option>
        <option>PUBG</option>
        <option>Liên Minh Huyền Thoại</option>
      </select>

      <label>Tên sản phẩm</label>
      <input type="text" id="productName" placeholder="VD: Valorant Diamond Account" />

      <label>Giá vốn (VNĐ)</label>
      <input type="number" id="basePrice" placeholder="VD: 300000" />

      <label>Tỉ lệ lợi nhuận (%)</label>
      <input type="number" id="profitRate" placeholder="VD: 20" />

      <div style="margin-top:10px; display:flex; gap:8px;">
        <button id="btnSave" class="add">Lưu giá bán</button>
        <button id="btnReset" class="reset">Xóa form</button>
      </div>
      <small id="formMsg" style="display:block;margin-top:8px;color:#94a3b8;">Dữ liệu được lưu bằng LocalStorage.</small>
    </div>

    <!-- Bảng giá sản phẩm -->
    <div class="card">
      <h3>Danh sách giá bán sản phẩm</h3>
      <input class="search" id="searchBox" type="text" placeholder="Tìm theo tên hoặc loại sản phẩm...">
      <div id="priceTableWrap"></div>
    </div>
  </div>

  <script>
    const LS_KEY = 'PRICE_LIST';

    function getPrices() {
      try { return JSON.parse(localStorage.getItem(LS_KEY)) || []; }
      catch { return []; }
    }
    function setPrices(data) { localStorage.setItem(LS_KEY, JSON.stringify(data)); }
    function genId() { return 'PR' + Math.random().toString(36).substr(2, 6).toUpperCase(); }

    function renderTable(keyword='') {
      const prices = getPrices();
      const wrap = document.getElementById('priceTableWrap');
      const filtered = prices.filter(p =>
        p.product.toLowerCase().includes(keyword.toLowerCase()) ||
        p.type.toLowerCase().includes(keyword.toLowerCase())
      );

      if (filtered.length === 0) {
        wrap.innerHTML = '<p style="color:#94a3b8">Chưa có dữ liệu giá bán.</p>';
        return;
      }

      let html = '<table><thead><tr><th>Loại</th><th>Tên sản phẩm</th><th>Giá vốn</th><th>Lợi nhuận (%)</th><th>Giá bán</th><th>Thao tác</th></tr></thead><tbody>';
      filtered.forEach(p => {
        const sellPrice = Math.round(p.base * (1 + p.profit / 100));
        html += `<tr>
          <td>${p.type}</td>
          <td>${p.product}</td>
          <td>${Number(p.base).toLocaleString()} ₫</td>
          <td>${p.profit}%</td>
          <td class="highlight">${sellPrice.toLocaleString()} ₫</td>
          <td class="actions">
            <button class="edit" onclick="editPrice('${p.id}')">Sửa</button>
            <button class="delete" onclick="deletePrice('${p.id}')">Xóa</button>
          </td>
        </tr>`;
      });
      html += '</tbody></table>';
      wrap.innerHTML = html;
    }

    document.getElementById('btnSave').addEventListener('click', () => {
      const type = document.getElementById('productType').value.trim();
      const product = document.getElementById('productName').value.trim();
      const base = document.getElementById('basePrice').value.trim();
      const profit = document.getElementById('profitRate').value.trim();

      if (!type || !product || !base || !profit) return alert('Vui lòng nhập đầy đủ thông tin.');

      let list = getPrices();
      const editId = document.getElementById('btnSave').dataset.editId;

      if (editId) {
        const item = list.find(x => x.id === editId);
        if (!item) return;
        item.type = type;
        item.product = product;
        item.base = Number(base);
        item.profit = Number(profit);
        document.getElementById('formMsg').innerText = 'Đã cập nhật thông tin giá bán.';
        delete document.getElementById('btnSave').dataset.editId;
      } else {
        const newItem = {
          id: genId(),
          type, product,
          base: Number(base),
          profit: Number(profit)
        };
        list.unshift(newItem);
        document.getElementById('formMsg').innerText = 'Đã thêm giá bán mới.';
      }

      setPrices(list);
      resetForm();
      renderTable();
    });

    function editPrice(id) {
      const list = getPrices();
      const item = list.find(x => x.id === id);
      if (!item) return;
      document.getElementById('productType').value = item.type;
      document.getElementById('productName').value = item.product;
      document.getElementById('basePrice').value = item.base;
      document.getElementById('profitRate').value = item.profit;
      document.getElementById('btnSave').dataset.editId = id;
      document.getElementById('formMsg').innerText = 'Đang sửa giá sản phẩm: ' + item.product;
      window.scrollTo({ top: 0, behavior: 'smooth' });
    }

    function deletePrice(id) {
      if (!confirm('Bạn có chắc muốn xóa sản phẩm này?')) return;
      let list = getPrices();
      list = list.filter(x => x.id !== id);
      setPrices(list);
      renderTable();
    }

    document.getElementById('btnReset').addEventListener('click', resetForm);
    function resetForm() {
      document.getElementById('productType').value = '';
      document.getElementById('productName').value = '';
      document.getElementById('basePrice').value = '';
      document.getElementById('profitRate').value = '';
      document.getElementById('formMsg').innerText = 'Dữ liệu được lưu bằng LocalStorage.';
      delete document.getElementById('btnSave').dataset.editId;
    }

    document.getElementById('searchBox').addEventListener('input', e => renderTable(e.target.value));

    renderTable();
  </script>
</body>
</html>
