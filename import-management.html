<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Quản lý nhập sản phẩm</title>
  <style>
    body {
      font-family: 'Poppins', sans-serif;
      background-color: #0f1724;
      color: #e2e8f0;
      margin: 0;
      padding: 24px;
    }
    .container { max-width: 1000px; margin: auto; }
    h1 { color: #38bdf8; font-size: 22px; }
    .card {
      background: rgba(255,255,255,0.04);
      border-radius: 12px;
      padding: 20px;
      margin-top: 20px;
      box-shadow: 0 0 10px rgba(0,0,0,0.3);
    }
    label { display: block; margin-top: 10px; }
    input, select {
      width: 100%;
      background: rgba(255,255,255,0.06);
      border: 1px solid rgba(255,255,255,0.1);
      color: #e2e8f0;
      padding: 8px;
      border-radius: 8px;
      outline: none;
      margin-top: 4px;
    }
    button {
      padding: 8px 14px;
      border: none;
      border-radius: 6px;
      cursor: pointer;
      font-weight: 600;
    }
    button.add { background: #06b6d4; color: #041324; }
    button.edit { background: #1e3a8a; color: #e0f2fe; }
    button.complete { background: #16a34a; color: white; }
    button.delete { background: #dc2626; color: white; }
    button.reset { background: transparent; border: 1px solid #475569; color: #94a3b8; }
    table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 16px;
    }
    th, td {
      text-align: left;
      padding: 10px;
      border-bottom: 1px solid rgba(255,255,255,0.08);
    }
    th { color: #94a3b8; font-size: 14px; }
    .actions button { margin-right: 6px; font-size: 13px; }
    .status {
      display: inline-block;
      padding: 4px 8px;
      border-radius: 999px;
      background: rgba(255,255,255,0.08);
      font-size: 12px;
    }
    .search {
      margin-bottom: 10px;
    }
  </style>
</head>
<body>
  <div class="container">
    <h1>Quản lý nhập sản phẩm</h1>

    <!-- Form thêm / sửa phiếu nhập -->
    <div class="card">
      <h3>Thêm / Sửa phiếu nhập hàng</h3>

      <label>Ngày nhập</label>
      <input type="date" id="importDate" />

      <label>Sản phẩm</label>
      <input type="text" id="importProduct" placeholder="VD: Valorant Diamond" />

      <label>Giá nhập (VNĐ)</label>
      <input type="number" id="importPrice" placeholder="VD: 500000" />

      <label>Số lượng</label>
      <input type="number" id="importQty" placeholder="VD: 10" />

      <div style="margin-top:10px; display:flex; gap:8px;">
        <button id="btnSave" class="add">Lưu phiếu nhập</button>
        <button id="btnReset" class="reset">Xóa form</button>
      </div>
      <small id="formMsg" style="display:block;margin-top:8px;color:#94a3b8;">Dữ liệu demo, lưu bằng LocalStorage.</small>
    </div>

    <!-- Danh sách phiếu nhập -->
    <div class="card">
      <h3>Danh sách phiếu nhập</h3>
      <input class="search" id="searchBox" type="text" placeholder="Tìm phiếu nhập theo mã hoặc tên sản phẩm...">
      <div id="importTableWrap"></div>
    </div>
  </div>

  <script>
    const LS_KEY = 'IMPORT_LIST';

    function getImports() {
      try { return JSON.parse(localStorage.getItem(LS_KEY)) || []; }
      catch { return []; }
    }
    function setImports(data) { localStorage.setItem(LS_KEY, JSON.stringify(data)); }
    function genId() { return 'IM' + Math.random().toString(36).substr(2, 6).toUpperCase(); }

    function renderTable(keyword='') {
      const imports = getImports();
      const wrap = document.getElementById('importTableWrap');
      const filtered = imports.filter(p =>
        p.product.toLowerCase().includes(keyword.toLowerCase()) ||
        p.id.toLowerCase().includes(keyword.toLowerCase())
      );

      if (filtered.length === 0) {
        wrap.innerHTML = '<p style="color:#94a3b8">Chưa có phiếu nhập nào.</p>';
        return;
      }

      let html = '<table><thead><tr><th>Mã phiếu</th><th>Ngày nhập</th><th>Sản phẩm</th><th>Giá nhập</th><th>Số lượng</th><th>Trạng thái</th><th>Thao tác</th></tr></thead><tbody>';
      filtered.forEach(p => {
        html += `<tr>
          <td>${p.id}</td>
          <td>${p.date}</td>
          <td>${p.product}</td>
          <td>${Number(p.price).toLocaleString()} ₫</td>
          <td>${p.qty}</td>
          <td><span class="status" style="color:${p.completed?'#16a34a':'#facc15'}">${p.completed?'Hoàn thành':'Chưa hoàn thành'}</span></td>
          <td class="actions">
            <button class="edit" onclick="editImport('${p.id}')" ${p.completed?'disabled':''}>Sửa</button>
            <button class="delete" onclick="deleteImport('${p.id}')">Xóa</button>
            <button class="complete" onclick="completeImport('${p.id}')" ${p.completed?'disabled':''}>Hoàn thành</button>
          </td>
        </tr>`;
      });
      html += '</tbody></table>';
      wrap.innerHTML = html;
    }

    document.getElementById('btnSave').addEventListener('click', () => {
      const date = document.getElementById('importDate').value;
      const product = document.getElementById('importProduct').value.trim();
      const price = document.getElementById('importPrice').value.trim();
      const qty = document.getElementById('importQty').value.trim();
      if (!date || !product || !price || !qty) return alert('Vui lòng nhập đầy đủ thông tin.');

      let list = getImports();
      const editId = document.getElementById('btnSave').dataset.editId;

      if (editId) {
        const item = list.find(x => x.id === editId);
        if (!item || item.completed) return;
        item.date = date;
        item.product = product;
        item.price = price;
        item.qty = qty;
        document.getElementById('formMsg').innerText = 'Đã cập nhật phiếu nhập.';
        delete document.getElementById('btnSave').dataset.editId;
      } else {
        const newItem = {
          id: genId(),
          date, product, price, qty,
          completed: false
        };
        list.unshift(newItem);
        document.getElementById('formMsg').innerText = 'Đã thêm phiếu nhập mới.';
      }

      setImports(list);
      resetForm();
      renderTable();
    });

    function editImport(id) {
      const list = getImports();
      const item = list.find(x => x.id === id);
      if (!item) return;
      if (item.completed) return alert('Không thể sửa phiếu đã hoàn thành.');
      document.getElementById('importDate').value = item.date;
      document.getElementById('importProduct').value = item.product;
      document.getElementById('importPrice').value = item.price;
      document.getElementById('importQty').value = item.qty;
      document.getElementById('btnSave').dataset.editId = id;
      document.getElementById('formMsg').innerText = 'Đang sửa phiếu nhập: ' + id;
      window.scrollTo({ top: 0, behavior: 'smooth' });
    }

    function deleteImport(id) {
      if (!confirm('Bạn có chắc muốn xóa phiếu nhập này?')) return;
      let list = getImports();
      list = list.filter(x => x.id !== id);
      setImports(list);
      renderTable();
    }

    function completeImport(id) {
      let list = getImports();
      const item = list.find(x => x.id === id);
      if (!item) return;
      item.completed = true;
      setImports(list);
      renderTable();
    }

    document.getElementById('btnReset').addEventListener('click', resetForm);
    function resetForm() {
      document.getElementById('importDate').value = '';
      document.getElementById('importProduct').value = '';
      document.getElementById('importPrice').value = '';
      document.getElementById('importQty').value = '';
      document.getElementById('formMsg').innerText = 'Dữ liệu demo, lưu bằng LocalStorage.';
      delete document.getElementById('btnSave').dataset.editId;
    }

    document.getElementById('searchBox').addEventListener('input', e => renderTable(e.target.value));

    renderTable();
  </script>
</body>
</html>
