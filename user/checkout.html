<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Thanh to√°n | AccountShop</title>
  <link rel="stylesheet" href="css/style.css">
  <style>
    body { font-family:"Segoe UI", sans-serif; background:#121212; color:#f5f5f5; margin:0; padding:0; }
    header { background:#1f1f1f; color:#00ffff; padding:15px 30px; display:flex; justify-content:space-between; align-items:center; box-shadow:0 0 10px #00ffff40; }
    header a { color:#00ffff; text-decoration:none; margin:0 10px; font-weight:bold; }
    header a:hover { color:#ffcc00; }
    h2,h3 { text-align:center; color:#ffd700; margin-top:20px; }
    form { max-width:600px; background:#1e1e1e; padding:30px; margin:30px auto; border-radius:16px; box-shadow:0 0 20px rgba(0,255,255,0.3); border:1px solid #333; }
    label { display:block; margin-top:12px; font-weight:bold; color:#00ffff; }
    input,select { width:100%; padding:10px; margin-top:6px; border:1px solid #00ffff60; border-radius:8px; background:#2c2c2c; color:#f5f5f5; font-size:1rem; outline:none; transition:border-color .3s; }
    input:focus,select:focus { border-color:#00ffff; box-shadow:0 0 5px #00ffff70; }
    #orderItems { border:1px solid #333; border-radius:10px; padding:10px; margin-top:15px; background:#2a2a2a; }
    .checkout-item { display:flex; justify-content:space-between; align-items:center; margin:10px 0; border-bottom:1px solid #333; padding-bottom:8px; }
    .checkout-item img { border-radius:6px; border:1px solid #444; }
    .qty-controls { display:flex; align-items:center; gap:5px; }
    .qty-controls button { background:#00b4d8; border:none; color:white; padding:4px 8px; border-radius:6px; cursor:pointer; }
    .qty-controls button:hover { background:#00d4ff; }
    #orderTotal { font-weight:bold; text-align:right; margin-top:15px; font-size:1.2em; color:#00ff99; }
    button[type="submit"] { background:#ff4500; color:white; border:none; padding:12px 15px; border-radius:8px; cursor:pointer; margin-top:20px; width:100%; font-size:1.1em; font-weight:bold; transition:.3s; box-shadow:0 0 10px #ff450080; }
    button[type="submit"]:hover { background:#ff6347; transform:scale(1.03); box-shadow:0 0 15px #ff634780; }
    footer { text-align:center; padding:20px; background:#1f1f1f; color:#aaa; border-top:1px solid #333; margin-top:40px; font-size:.9rem; }
    #logoutBtn { background:#ff4444; color:white; border:none; padding:6px 12px; border-radius:6px; cursor:pointer; transition:.3s; }
    #logoutBtn:hover { background:#ff6666; }
    .modal { display:none; position:fixed; z-index:999; left:0;top:0;width:100%;height:100%; background:rgba(0,0,0,.8); justify-content:center; align-items:center; }
    .modal-content { background:#1f1f1f; color:#fff; padding:30px; border-radius:12px; text-align:center; width:400px; box-shadow:0 0 20px #00ffff80; border:1px solid #00ffff50; animation: popupFade .4s ease; }
    @keyframes popupFade { from { opacity:0; transform:scale(0.8); } to { opacity:1; transform:scale(1); } }
    .modal-content h3 { color:#00ff99; margin-bottom:10px; }
    .modal-content p { color:#ccc; margin-bottom:20px; }
    .close-modal-btn { background:#00b4d8; color:white; border:none; padding:10px 20px; border-radius:8px; cursor:pointer; font-weight:bold; transition:.3s; }
    .close-modal-btn:hover { background:#00d4ff; transform:scale(1.05); }
  </style>
</head>
<body>
  <header>
    <div>
      <a href="index.html">üè† Trang ch·ªß</a>
      <a href="profile.html">üë§ Trang c√° nh√¢n</a>
    </div>
    <div>
      <span id="userInfo"></span>
      <button id="logoutBtn" style="display:none;">ƒêƒÉng xu·∫•t</button>
    </div>
  </header>

  <h2>üßæ Th√¥ng tin giao h√†ng</h2>

  <form id="checkoutForm">
    <label for="name">T√™n:</label>
    <input type="text" id="name" required>

    <label for="phone">S·ªë ƒëi·ªán tho·∫°i:</label>
    <input type="text" id="phone" required>

    <label for="address">ƒê·ªãa ch·ªâ:</label>
    <input type="text" id="address" required>

    <label for="payment">Ph∆∞∆°ng th·ª©c thanh to√°n:</label>
    <select id="payment">
      <option value="cod">üíµ Ti·ªÅn m·∫∑t khi nh·∫≠n h√†ng</option>
      <option value="bank">üè¶ Chuy·ªÉn kho·∫£n</option>
      <option value="Thanh to√°n tr·ª±c tuy·∫øn">Thanh to√°n tr·ª±c tuy·∫øn</option>
    </select>

    <h3>üõí ƒê∆°n h√†ng c·ªßa b·∫°n</h3>
    <div id="orderItems"></div>
    <p id="orderTotal">T·ªïng: 0‚Ç´</p>

    <button type="submit">‚úÖ ƒê·∫∑t h√†ng</button>
  </form>

  <footer>¬© 2025 AccountShop</footer>

  <div id="successModal">
  <h2>‚úÖ ƒê·∫∑t h√†ng th√†nh c√¥ng!</h2>
  <div id="recentOrder"></div>
  <button id="closeSuccess">ƒê√≥ng</button>
</div>


  <script>
document.addEventListener("DOMContentLoaded", () => {
  const userInfo = document.getElementById("userInfo");
  const logoutBtn = document.getElementById("logoutBtn");
  const form = document.getElementById("checkoutForm");
  const orderItems = document.getElementById("orderItems");
  const orderTotal = document.getElementById("orderTotal");
  const modal = document.getElementById("successModal");
  const closeModal = document.getElementById("closeSuccess");

  // Ki·ªÉm tra ƒëƒÉng nh·∫≠p
  const currentUser = JSON.parse(localStorage.getItem("loggedInUser"));
  if (!currentUser) { alert("‚ö†Ô∏è Vui l√≤ng ƒëƒÉng nh·∫≠p!"); window.location.href="login.html"; return; }
  userInfo.textContent = `Xin ch√†o, ${currentUser.name}`;
  logoutBtn.style.display = "inline-block";
  logoutBtn.addEventListener("click", ()=> { localStorage.removeItem("loggedInUser"); window.location.href="index.html"; });

  const cartKey = `cart_${currentUser.email}`;
  let cart = JSON.parse(localStorage.getItem(cartKey)) || [];
  const checkoutProduct = JSON.parse(localStorage.getItem("selectedProduct"));
  if (checkoutProduct) cart = [{...checkoutProduct, qty:1}];

  function renderCart(){
    orderItems.innerHTML="";
    if(cart.length===0){ orderItems.innerHTML="<p>üõí Gi·ªè h√†ng tr·ªëng</p>"; orderTotal.textContent=""; return; }
    let total=0;
    cart.forEach((item,index)=>{
      const numPrice=parseInt(item.price.replace(/[^\d]/g,""));
      total+=numPrice*item.qty;
      const div=document.createElement("div");
      div.className="checkout-item";
      div.innerHTML=`
        <img src="${item.img}" alt="${item.name}" width="60">
        <span>${item.name}</span>
        <div class="qty-controls">
          <button class="dec" data-index="${index}">-</button>
          <span>${item.qty}</span>
          <button class="inc" data-index="${index}">+</button>
        </div>
        <strong>${item.price}</strong>
      `;
      orderItems.appendChild(div);
    });
    orderTotal.textContent="üíµ T·ªïng: "+total.toLocaleString("vi-VN")+"‚Ç´";

    // TƒÉng gi·∫£m s·ªë l∆∞·ª£ng
    document.querySelectorAll(".inc").forEach(btn=>{
      btn.addEventListener("click",()=>{
        const i=btn.dataset.index; cart[i].qty++; if(!checkoutProduct) localStorage.setItem(cartKey,JSON.stringify(cart)); renderCart();
      });
    });
    document.querySelectorAll(".dec").forEach(btn=>{
      btn.addEventListener("click",()=>{
        const i=btn.dataset.index; if(cart[i].qty>1) cart[i].qty--; if(!checkoutProduct) localStorage.setItem(cartKey,JSON.stringify(cart)); renderCart();
      });
    });
  }

  renderCart();

  form.addEventListener("submit",e=>{
    e.preventDefault();
    const name=document.getElementById("name").value.trim();
    const phone=document.getElementById("phone").value.trim();
    const address=document.getElementById("address").value.trim();
    const payment=document.getElementById("payment").value;
    if(!name||!phone||!address){ alert("‚ö†Ô∏è Vui l√≤ng nh·∫≠p ƒë·∫ßy ƒë·ªß th√¥ng tin!"); return; }
    const total=cart.reduce((sum,item)=>sum+parseInt(item.price.replace(/[^\d]/g,""))*item.qty,0);
    const order={ date:new Date().toLocaleString("vi-VN"), items:cart, total:total.toLocaleString("vi-VN")+"‚Ç´", customer:{name,phone,address,payment} };
    const orderKey=`orders_${currentUser.email}`;
    const orders=JSON.parse(localStorage.getItem(orderKey))||[];
    orders.push(order); localStorage.setItem(orderKey,JSON.stringify(orders));
    if(!checkoutProduct) localStorage.removeItem(cartKey); localStorage.removeItem("selectedProduct");
    modal.style.display="flex";
  });

  closeModal.addEventListener("click",()=>{ modal.style.display="none"; window.location.href="profile.html"; });
  window.addEventListener("click",e=>{ if(e.target.id==="successModal") modal.style.display="none"; });
});
  </script>
</body>
</html>


